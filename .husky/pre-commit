#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ZERO TOLERANCE POLICY: ALL CHECKS MUST PASS
# This pre-commit hook ensures immediate feedback and blocks commits if any check fails

echo "ğŸ” Running pre-commit checks..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Set strict error handling
set -e
trap 'echo "âŒ Pre-commit checks FAILED. Commit blocked." && exit 1' ERR

# Function to run a check with status reporting
run_check() {
    local name="$1"
    local command="$2"
    
    echo "ğŸ“‹ $name..."
    
    if eval "$command" > /tmp/hook_output 2>&1; then
        echo "âœ… $name passed"
    else
        echo "âŒ $name FAILED"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ERROR OUTPUT:"
        cat /tmp/hook_output
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ’¡ To fix: npm run checks:fix"
        exit 1
    fi
}

# Run pre-commit checks in order
echo "ğŸ”§ 1/1 ESLint (Code Quality)"
run_check "ESLint" "npm run lint"

echo ""
echo "â„¹ï¸  Note: TypeScript and tests are checked on push"
echo "   To run all checks now: npm run checks:all"

# Success message
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… ALL PRE-COMMIT CHECKS PASSED!"
echo "ğŸš€ Commit proceeding..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Clean up
rm -f /tmp/hook_output